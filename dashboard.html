<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebDefender-X | Security Operations Dashboard</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />

  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg-main: #050816;
      --bg-elevated: #0b1020;
      --bg-elevated-soft: #101427;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.15);
      --accent-strong: #22c55e;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.25);
      --danger: #ef4444;
      --warn: #f97316;
      --ok: #22c55e;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.7);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;
      --transition-fast: 180ms ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body, html {
      margin: 0;
      padding: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 40%, #020617 100%);
      color: var(--text-main);
      height: 100%;
      scroll-behavior: smooth;
    }

    body {
      display: flex;
      min-height: 100vh;
    }

    /* Layout */
    .app-shell {
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      width: 100%;
    }

    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: sticky;
        top: 0;
        z-index: 20;
        border-right: none;
        border-bottom: 1px solid var(--border-subtle);
        flex-direction: row;
        padding: 10px 16px;
        align-items: center;
        justify-content: space-between;
      }
      .sidebar-nav {
        flex-direction: row;
        width: auto;
      }
      .sidebar-nav a {
        margin-right: 10px;
      }
      .sidebar-footer {
        display: none;
      }
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(150deg, #020617 0%, #020617 45%, #020617 100%);
      border-right: 1px solid var(--border-subtle);
      padding: 24px 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .sidebar-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-mark {
      width: 32px;
      height: 32px;
      border-radius: 30%;
      background: radial-gradient(circle at 30% 30%, #22c55e, #3b82f6);
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.4), 0 12px 30px rgba(15, 23, 42, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-weight: 700;
      font-size: 0.9rem;
      color: #e5f0ff;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-text span:first-child {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-weight: 600;
      letter-spacing: 0.06em;
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    .brand-text span:last-child {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .sidebar-section-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
    }

    .sidebar-nav a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      text-decoration: none;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-radius: 999px;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }

    .sidebar-nav a span.icon-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--border-subtle);
    }

    .sidebar-nav a:hover {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      transform: translateX(2px);
    }

    .sidebar-nav a.active {
      background: var(--accent-soft);
      color: #e5f0ff;
    }

    .sidebar-nav a.active .icon-dot {
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.35);
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 10px;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .status-pill {
      align-self: flex-start;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(22, 163, 74, 0.08);
      border-radius: var(--radius-pill);
      padding: 4px 9px;
      font-size: 0.72rem;
      border: 1px solid rgba(34, 197, 94, 0.45);
      color: #bbf7d0;
    }

    .status-pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--ok);
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.38);
    }

    /* Content */
    .content {
      padding: 18px 22px 22px;
      max-width: 1320px;
      width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .page-title {
      font-family: "Space Grotesk", system-ui, sans-serif;
      font-size: 1.45rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .page-title span.badge {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: rgba(30, 64, 175, 0.7);
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.7);
      color: #c7d2fe;
    }

    .page-subtitle {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .chip {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      padding: 5px 9px;
      font-size: 0.78rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.7);
    }

    .chip strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
    }

    .chip-warning .chip-dot {
      background: var(--warn);
    }

    .chip-danger .chip-dot {
      background: var(--danger);
    }

    .chip-select {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 0.8rem;
      padding: 5px 8px;
    }

    /* Main sections */
    main {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    section {
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 1));
      border: 1px solid rgba(31, 41, 55, 0.95);
      box-shadow: var(--shadow-soft);
      padding: 16px 16px 14px;
    }

    section.compact {
      padding: 14px 12px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
      gap: 10px;
    }

    .section-title {
      font-size: 0.92rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.35);
    }

    .section-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* KPI cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 1100px) {
      .kpi-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 640px) {
      .kpi-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .kpi-card {
      border-radius: var(--radius-md);
      padding: 12px 12px 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
      position: relative;
      overflow: hidden;
    }

    .kpi-label-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .kpi-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .kpi-tag {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #cbd5f5;
      background: rgba(15, 23, 42, 0.9);
    }

    .kpi-value {
      font-size: 1.7rem;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .kpi-unit {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-left: 4px;
    }

    .kpi-bottom-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 0.76rem;
    }

    .kpi-trend {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .kpi-trend span.value {
      font-weight: 500;
    }

    .trend-up {
      color: var(--ok);
    }

    .trend-down {
      color: var(--danger);
    }

    .trend-neutral {
      color: var(--text-muted);
    }

    .kpi-caption {
      color: var(--text-muted);
    }

    .kpi-progress {
      position: relative;
      flex: 1;
      height: 6px;
      margin-left: 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.94);
      overflow: hidden;
    }

    .kpi-progress-bar {
      position: absolute;
      inset: 0;
      width: 0;
      border-radius: inherit;
      background: linear-gradient(90deg, #22c55e, #a3e635);
      box-shadow: 0 0 10px rgba(22, 163, 74, 0.8);
      transition: width 260ms ease-out;
    }

    /* Charts layout */
    .chart-grid {
      display: grid;
      grid-template-columns: 1.3fr 1.1fr 1.1fr;
      gap: 12px;
    }

    @media (max-width: 1100px) {
      .chart-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 800px) {
      .chart-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .chart-card {
      border-radius: var(--radius-md);
      padding: 10px 11px 6px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 1), rgba(15, 23, 42, 0.98));
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 220px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .chart-title {
      font-size: 0.85rem;
      font-weight: 500;
      color: #e5e7eb;
    }

    .chart-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .chart-meta span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      display: inline-block;
      margin-right: 3px;
      background: rgba(148, 163, 184, 0.7);
    }

    .chart-body {
      flex: 1;
      position: relative;
    }

    .chart-body canvas {
      width: 100%;
      height: 100%;
    }

    /* Secondary grid */
    .secondary-grid {
      display: grid;
      grid-template-columns: 1.5fr 1.1fr;
      gap: 12px;
    }

    @media (max-width: 1100px) {
      .secondary-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .table-card {
      border-radius: var(--radius-md);
      padding: 10px 10px 8px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 1), rgba(15, 23, 42, 0.96));
    }

    .table-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
      gap: 8px;
    }

    .table-title {
      font-size: 0.85rem;
      font-weight: 500;
    }

    .table-title small {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    .table-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .data-table thead {
      color: #e5e7eb;
    }

    .data-table th,
    .data-table td {
      padding: 5px 3px;
      text-align: left;
      border-bottom: 1px solid rgba(31, 41, 55, 0.95);
      white-space: nowrap;
    }

    .data-table th:last-child,
    .data-table td:last-child {
      text-align: right;
    }

    .badge-severity {
      border-radius: 999px;
      padding: 1px 7px;
      font-size: 0.7rem;
      border: 1px solid transparent;
      display: inline-flex;
      align-items: center;
      gap: 3px;
    }

    .badge-severity.critical {
      border-color: rgba(248, 113, 113, 0.7);
      background: rgba(127, 29, 29, 0.6);
      color: #fecaca;
    }

    .badge-severity.high {
      border-color: rgba(248, 171, 60, 0.85);
      background: rgba(120, 53, 15, 0.7);
      color: #fed7aa;
    }

    .badge-severity.medium {
      border-color: rgba(251, 191, 36, 0.7);
      background: rgba(82, 47, 6, 0.9);
      color: #facc15;
    }

    .badge-severity.low {
      border-color: rgba(52, 211, 153, 0.6);
      background: rgba(6, 78, 59, 0.7);
      color: #a7f3d0;
    }

    /* Logs */
    #logs-section {
      margin-top: 0;
    }

    #log-feed {
      max-height: 220px;
      overflow-y: auto;
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.3), #020617 60%);
      color: #a5f3fc;
      font-family: "Space Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.8rem;
      padding: 9px 9px 7px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(56, 189, 248, 0.4);
      box-shadow: inset 0 0 38px rgba(15, 23, 42, 0.9);
      position: relative;
    }

    #log-feed::before {
      content: "LIVE";
      position: absolute;
      top: 6px;
      right: 9px;
      font-size: 0.68rem;
      letter-spacing: 0.16em;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(34, 197, 94, 0.7);
      background: rgba(6, 95, 70, 0.8);
      color: #bbf7d0;
    }

    #log-feed p {
      margin: 0 0 5px;
      white-space: pre;
    }

    /* Footer */
    footer {
      text-align: right;
      font-size: 0.75rem;
      color: var(--text-muted);
      padding-top: 4px;
    }

    footer span.highlight {
      color: #e5e7eb;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-brand">
      <div class="brand-mark">WX</div>
      <div class="brand-text">
        <span>WEBDEFENDER-X</span>
        <span>Runtime Security &amp; Analytics</span>
      </div>
    </div>

    <div>
      <div class="sidebar-section-label">Navigation</div>
      <nav class="sidebar-nav">
        <a href="#overview" class="active">
          <span class="icon-dot"></span>
          <span>Overview</span>
        </a>
        <a href="#analytics">
          <span class="icon-dot"></span>
          <span>Threat Analytics</span>
        </a>
        <a href="#insights">
          <span class="icon-dot"></span>
          <span>Insights</span>
        </a>
        <a href="#logs-section">
          <span class="icon-dot"></span>
          <span>Live Event Stream</span>
        </a>
      </nav>
    </div>

    <div class="sidebar-footer">
      <div class="status-pill">
        <span class="status-pill-dot"></span>
        Cluster healthy · all nodes online
      </div>
      <div>Protected surface: <strong>edge + app + APIs</strong></div>
      <div>© 2025 WebDefender-X</div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="content">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="page-title">
          WEBDEFENDER - X
        </div>
        <div class="page-subtitle">
          End-to-end telemetry of inbound traffic, mitigations, and threat posture for your protected assets.
        </div>
      </div>
      <div class="topbar-right">
        <div class="chip">
          <span class="chip-dot"></span>
          <span>Environment: <strong>Production Edge</strong></span>
        </div>
        <div class="chip chip-warning">
          <span class="chip-dot"></span>
          <span>Active incidents: <strong id="incident-count">0</strong></span>
        </div>
        <select class="chip-select" aria-label="Time window">
          <option>Last 15 minutes</option>
          <option selected>Last 60 minutes</option>
          <option>Last 6 hours</option>
          <option>Last 24 hours</option>
        </select>
      </div>
    </header>

    <main>
      <!-- OVERVIEW / KPIs -->
      <section id="overview" aria-label="Overview KPIs">
        <div class="section-header">
          <div class="section-title">
            <span class="section-title-dot"></span>
            OVERVIEW
          </div>
          <div class="section-subtitle">
            Live traffic, blocked attacks, and detection performance across the selected window.
          </div>
        </div>

        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-label-row">
              <div class="kpi-label">Total Requests</div>
              <div class="kpi-tag">Edge traffic</div>
            </div>
            <div class="kpi-value">
              <span id="total-requests">0</span>
            </div>
            <div class="kpi-bottom-row">
              <div class="kpi-trend">
                <span class="trend-up value" id="total-requests-trend">+0.0%</span>
                <span class="kpi-caption">vs. previous window</span>
              </div>
            </div>
          </div>

          <div class="kpi-card">
            <div class="kpi-label-row">
              <div class="kpi-label">Blocked Attacks</div>
              <div class="kpi-tag">WAF &amp; rules</div>
            </div>
            <div class="kpi-value">
              <span id="blocked-attacks">0</span>
            </div>
            <div class="kpi-bottom-row">
              <div class="kpi-trend">
                <span class="trend-up value" id="block-rate">0.0%</span>
                <span class="kpi-caption">of hostile traffic</span>
              </div>
            </div>
          </div>

          <div class="kpi-card">
            <div class="kpi-label-row">
              <div class="kpi-label">Malware Uploads</div>
              <div class="kpi-tag">Object storage</div>
            </div>
            <div class="kpi-value">
              <span id="malware-upload">0</span>
              <span class="kpi-unit">blocked</span>
            </div>
            <div class="kpi-bottom-row">
              <div class="kpi-trend">
                <span class="trend-down value" id="malware-trend">-0.0%</span>
                <span class="kpi-caption">trend vs. baseline</span>
              </div>
            </div>
          </div>

          <div class="kpi-card">
            <div class="kpi-label-row">
              <div class="kpi-label">Detection Accuracy</div>
              <div class="kpi-tag">ML engine</div>
            </div>
            <div class="kpi-value">
              <span id="detection-accuracy">0</span><span class="kpi-unit">%</span>
            </div>
            <div class="kpi-bottom-row">
              <div class="kpi-caption">Precision of classification</div>
              <div class="kpi-progress" aria-hidden="true">
                <div class="kpi-progress-bar" id="accuracy-bar"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ANALYTICS / CHARTS -->
      <section id="analytics" aria-label="Threat analytics">
        <div class="section-header">
          <div class="section-title">
            <span class="section-title-dot"></span>
            THREAT ANALYTICS
          </div>
          <div class="section-subtitle">
            Distribution of attack classes, time-series of inbound load, and severity mix across the perimeter.
          </div>
        </div>

        <div class="chart-grid">
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Attack Class Mix</div>
              <div class="chart-meta">
                <span class="dot"></span> share of blocked events
              </div>
            </div>
            <div class="chart-body">
              <canvas id="attack-chart"></canvas>
            </div>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Request Rate</div>
              <div class="chart-meta">
                <span class="dot"></span> per second · sampled
              </div>
            </div>
            <div class="chart-body">
              <canvas id="traffic-chart"></canvas>
            </div>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Severity Distribution</div>
              <div class="chart-meta">
                <span class="dot"></span> open vs mitigated
              </div>
            </div>
            <div class="chart-body">
              <canvas id="severity-chart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- INSIGHTS + LOGS -->
      <section id="insights" aria-label="Insights and live events" class="compact">
        <div class="section-header">
          <div class="section-title">
            <span class="section-title-dot"></span>
            INSIGHTS &amp; LIVE EVENTS
          </div>
          <div class="section-subtitle">
            Top noisy sources, severity profile, and the live security event stream.
          </div>
        </div>

        <div class="secondary-grid">
          <!-- TABLE: TOP SOURCES / INCIDENTS -->
          <div class="table-card">
            <div class="table-title-row">
              <div class="table-title">
                Top Noisy Sources
                <small>Generated from current attack distribution</small>
              </div>
              <div class="table-meta" id="threat-level-label">
                Threat level: <strong>observing</strong>
              </div>
            </div>
            <table class="data-table" aria-label="Top attacking sources">
              <thead>
              <tr>
                <th>Source IP / ASN</th>
                <th>Attack Class</th>
                <th>Severity</th>
                <th>Events</th>
              </tr>
              </thead>
              <tbody id="top-sources-tbody">
              <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>

          <!-- LIVE LOGS -->
          <div id="logs-section" class="table-card">
            <div class="table-title-row">
              <div class="table-title">
                Live Event Stream
                <small>Newest security events at the bottom</small>
              </div>
              <div class="table-meta">
                Updating every ~2 seconds
              </div>
            </div>
            <div id="log-feed">
              <p>Bootstrapping WebDefender-X telemetry…</p>
            </div>
          </div>
        </div>
      </section>

      <footer>
        <span class="highlight">WebDefender-X</span> · Inline WAF · Behavioral analytics · Continuous protection
      </footer>
    </main>
  </div>
</div>

<script>
  // Global chart references
  let attackChart, trafficChart, severityChart;

  // Previous metrics for simple trend calc
  let prevTotals = {
    totalRequests: 0,
    blockedAttacks: 0,
    malwareUpload: 0
  };

  // Smooth number animation
  function animateCounter(el, target, prevValue) {
    const start = typeof prevValue === "number" ? prevValue : 0;
    const diff  = target - start;
    const steps = 40;
    let currentStep = 0;

    function step() {
      currentStep++;
      const progress = Math.min(currentStep / steps, 1);
      const value = start + diff * progress;
      el.textContent = Math.round(value).toLocaleString();
      if (progress < 1) {
        requestAnimationFrame(step);
      }
    }
    requestAnimationFrame(step);
  }

  // Fake data generator (replace with real backend wiring later)
  function fetchData() {
    return new Promise((resolve) => {
      const totalRequests = Math.floor(Math.random() * 60000) + 20000;
      const blockedAttacks = Math.floor(Math.random() * 5000) + 1000;
      const malwareUpload = Math.floor(Math.random() * 500);
      const detectionAccuracy = +(Math.random() * 15 + 85).toFixed(2);

      const attackDistribution = {
        "SQL Injection": Math.floor(Math.random() * 100),
        "XSS": Math.floor(Math.random() * 100),
        "DDoS": Math.floor(Math.random() * 100),
        "Malware": Math.floor(Math.random() * 100),
        "Brute Force": Math.floor(Math.random() * 100)
      };

      const trafficSeries = Array.from({ length: 16 }, () =>
        Math.floor(Math.random() * 220 + 40)
      );

      const threatSeverity = {
        Critical: Math.floor(Math.random() * 60),
        High: Math.floor(Math.random() * 80),
        Medium: Math.floor(Math.random() * 120),
        Low: Math.floor(Math.random() * 90)
      };

      const ips = ["203.0.113.1", "198.51.100.8", "192.0.2.20", "172.16.0.5", "10.0.0.23", "203.0.113.44"];
      const msgs = ["SQLi", "XSS", "DDoS", "Malware upload", "Brute force", "Blacklisted", "Path traversal"];
      const logs = Array.from({ length: 7 }, () => {
        const ip = ips[Math.floor(Math.random() * ips.length)];
        const msg = msgs[Math.floor(Math.random() * msgs.length)];
        const now = new Date().toLocaleTimeString();
        return `[${now}] Blocked IP ${ip} (${msg})`;
      });

      setTimeout(() => {
        resolve({
          totalRequests,
          blockedAttacks,
          malwareUpload,
          detectionAccuracy,
          attackDistribution,
          trafficSeries,
          threatSeverity,
          logs
        });
      }, 300);
    });
  }

  // Build some simple "top sources" from distribution
  function buildTopSources(attackDistribution) {
    const attackTypes = Object.keys(attackDistribution);
    const severities = ["Critical", "High", "Medium", "Low"];
    const asns = ["AS15169", "AS32934", "AS13335", "AS8075", "AS16509"];

    return Array.from({ length: 5 }, (_, idx) => {
      const randomAttack = attackTypes[idx % attackTypes.length];
      const severity = severities[Math.floor(Math.random() * severities.length)];
      const ip = `203.0.113.${Math.floor(Math.random() * 130 + 10)}`;
      const asn = asns[Math.floor(Math.random() * asns.length)];
      const events = attackDistribution[randomAttack] + Math.floor(Math.random() * 40);
      return { ip, asn, attack: randomAttack, severity, events };
    }).sort((a, b) => b.events - a.events);
  }

  function severityToClass(sev) {
    switch (sev) {
      case "Critical": return "critical";
      case "High": return "high";
      case "Medium": return "medium";
      default: return "low";
    }
  }

  function computeThreatLevel(severityCounts) {
    const score =
      severityCounts.Critical * 4 +
      severityCounts.High * 3 +
      severityCounts.Medium * 2 +
      severityCounts.Low * 1;

    if (score > 550) return { label: "elevated", color: "var(--warn)" };
    if (score > 350) return { label: "heightened", color: "var(--danger)" };
    if (score < 180) return { label: "observing", color: "var(--ok)" };
    return { label: "steady", color: "var(--accent)" };
  }

  // Update DOM + charts
  function updateDashboard() {
    fetchData().then((data) => {
      const {
        totalRequests,
        blockedAttacks,
        malwareUpload,
        detectionAccuracy,
        attackDistribution,
        trafficSeries,
        threatSeverity,
        logs
      } = data;

      // KPIs
      const totalEl = document.getElementById("total-requests");
      const blockedEl = document.getElementById("blocked-attacks");
      const malwareEl = document.getElementById("malware-upload");
      const accuracyEl = document.getElementById("detection-accuracy");
      const accuracyBar = document.getElementById("accuracy-bar");

      animateCounter(totalEl, totalRequests, prevTotals.totalRequests);
      animateCounter(blockedEl, blockedAttacks, prevTotals.blockedAttacks);
      animateCounter(malwareEl, malwareUpload, prevTotals.malwareUpload);

      accuracyEl.textContent = detectionAccuracy.toFixed(2);

      const blockRate = totalRequests > 0 ? (blockedAttacks / totalRequests) * 100 : 0;
      const blockRateEl = document.getElementById("block-rate");
      blockRateEl.textContent = blockRate.toFixed(1) + "%";

      // Simple trends vs previous values
      function computeTrend(current, previous) {
        if (!previous) return 0;
        return ((current - previous) / previous) * 100;
      }

      const totalTrend = computeTrend(totalRequests, prevTotals.totalRequests);
      const malwareTrend = computeTrend(malwareUpload, prevTotals.malwareUpload);

      const totalTrendEl = document.getElementById("total-requests-trend");
      const malwareTrendEl = document.getElementById("malware-trend");

      function setTrend(el, value) {
        const absolute = (Math.abs(value)).toFixed(1);
        if (value > 0.3) {
          el.textContent = "+" + absolute + "%";
          el.className = "trend-up value";
        } else if (value < -0.3) {
          el.textContent = "-" + absolute + "%";
          el.className = "trend-down value";
        } else {
          el.textContent = "+0.0%";
          el.className = "trend-neutral value";
        }
      }

      setTrend(totalTrendEl, totalTrend);
      setTrend(malwareTrendEl, -malwareTrend); // inverse for "improvement"

      // Accuracy bar
      const clampedAcc = Math.max(0, Math.min(100, detectionAccuracy));
      accuracyBar.style.width = clampedAcc + "%";

      // Incident count (approx based on Critical + High)
      const incidentCount = threatSeverity.Critical + Math.round(threatSeverity.High * 0.6);
      document.getElementById("incident-count").textContent = incidentCount.toString();

      // Charts
      const attackLabels = Object.keys(attackDistribution);
      const attackValues = Object.values(attackDistribution);

      if (!attackChart) {
        Chart.defaults.color = "#9ca3af";
        Chart.defaults.font.family = "Inter, system-ui, sans-serif";

        attackChart = new Chart(
          document.getElementById("attack-chart").getContext("2d"),
          {
            type: "doughnut",
            data: {
              labels: attackLabels,
              datasets: [{
                data: attackValues,
                backgroundColor: [
                  "#3b82f6",
                  "#22c55e",
                  "#f97316",
                  "#6366f1",
                  "#a855f7"
                ],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: true,
                  position: "bottom",
                  labels: {
                    boxWidth: 10,
                    boxHeight: 10,
                    padding: 12
                  }
                },
                tooltip: {
                  backgroundColor: "#020617",
                  padding: 10,
                  borderColor: "#1f2937",
                  borderWidth: 1,
                  callbacks: {
                    label: (ctx) => `${ctx.label}: ${ctx.parsed} events`
                  }
                }
              },
              cutout: "60%"
            }
          }
        );
      } else {
        attackChart.data.labels = attackLabels;
        attackChart.data.datasets[0].data = attackValues;
        attackChart.update();
      }

      if (!trafficChart) {
        trafficChart = new Chart(
          document.getElementById("traffic-chart").getContext("2d"),
          {
            type: "line",
            data: {
              labels: trafficSeries.map((_, idx) => `T-${trafficSeries.length - idx}`),
              datasets: [{
                label: "Requests / second",
                data: trafficSeries,
                borderWidth: 1.7,
                borderColor: "#3b82f6",
                fill: true,
                pointRadius: 0,
                tension: 0.35,
                backgroundColor: "rgba(37, 99, 235, 0.16)"
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: "#020617",
                  padding: 10,
                  borderColor: "#1f2937",
                  borderWidth: 1
                }
              },
              scales: {
                x: {
                  grid: {
                    color: "rgba(31, 41, 55, 0.75)"
                  },
                  ticks: {
                    maxTicksLimit: 6
                  }
                },
                y: {
                  grid: {
                    color: "rgba(31, 41, 55, 0.75)"
                  },
                  ticks: {
                    maxTicksLimit: 4
                  }
                }
              }
            }
          }
        );
      } else {
        trafficChart.data.datasets[0].data = trafficSeries;
        trafficChart.data.labels = trafficSeries.map((_, idx) => `T-${trafficSeries.length - idx}`);
        trafficChart.update();
      }

      const severityLabels = Object.keys(threatSeverity);
      const severityValues = Object.values(threatSeverity);

      if (!severityChart) {
        severityChart = new Chart(
          document.getElementById("severity-chart").getContext("2d"),
          {
            type: "bar",
            data: {
              labels: severityLabels,
              datasets: [{
                data: severityValues,
                backgroundColor: [
                  "#ef4444",
                  "#f97316",
                  "#3b82f6",
                  "#22c55e"
                ],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: "#020617",
                  padding: 10,
                  borderColor: "#1f2937",
                  borderWidth: 1,
                  callbacks: {
                    label: (ctx) => `${ctx.parsed.y} events`
                  }
                }
              },
              scales: {
                x: {
                  grid: {
                    display: false
                  }
                },
                y: {
                  grid: {
                    color: "rgba(31, 41, 55, 0.75)"
                  },
                  ticks: {
                    maxTicksLimit: 4
                  }
                }
              }
            }
          }
        );
      } else {
        severityChart.data.labels = severityLabels;
        severityChart.data.datasets[0].data = severityValues;
        severityChart.update();
      }

      // Top sources table
      const topSources = buildTopSources(attackDistribution);
      const tbody = document.getElementById("top-sources-tbody");
      tbody.innerHTML = "";

      topSources.forEach((src) => {
        const tr = document.createElement("tr");

        const ipCell = document.createElement("td");
        ipCell.textContent = src.ip + " · " + src.asn;
        tr.appendChild(ipCell);

        const attackCell = document.createElement("td");
        attackCell.textContent = src.attack;
        tr.appendChild(attackCell);

        const severityCell = document.createElement("td");
        const badge = document.createElement("span");
        badge.className = "badge-severity " + severityToClass(src.severity);
        badge.textContent = src.severity;
        severityCell.appendChild(badge);
        tr.appendChild(severityCell);

        const eventsCell = document.createElement("td");
        eventsCell.textContent = src.events.toLocaleString();
        tr.appendChild(eventsCell);

        tbody.appendChild(tr);
      });

      // Threat level label
      const threatMeta = computeThreatLevel(threatSeverity);
      const threatLabel = document.getElementById("threat-level-label");
      threatLabel.innerHTML = `Threat level: <strong style="color:${threatMeta.color}">${threatMeta.label}</strong>`;

      // Logs
      const logFeed = document.getElementById("log-feed");
      logFeed.innerHTML = "";
      logs.forEach((entry) => {
        const p = document.createElement("p");
        p.textContent = entry;
        logFeed.appendChild(p);
      });
      logFeed.scrollTop = logFeed.scrollHeight;

      // Persist previous totals for next trend calculation
      prevTotals = {
        totalRequests,
        blockedAttacks,
        malwareUpload
      };
    });
  }

  // Initial run + interval
  updateDashboard();
  setInterval(updateDashboard, 2000);
</script>
</body>
</html>
